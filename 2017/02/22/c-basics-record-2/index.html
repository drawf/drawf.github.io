<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="测试一下描述"><title>C语言基础知识补习② | erwa'blog</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">C语言基础知识补习②</h1><a id="logo" href="/.">erwa'blog</a><p class="description">非常高兴你能来到这里！</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">C语言基础知识补习②</h1><div class="post-meta">Feb 22, 2017<span> | </span><span class="category"><a href="/categories/tech/">tech</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-thread-key="2017/02/22/c-basics-record-2/" href="/2017/02/22/c-basics-record-2/#comments" class="ds-thread-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#放在前边"><span class="toc-number">1.</span> <span class="toc-text">放在前边</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C-C-的开发工具"><span class="toc-number">2.</span> <span class="toc-text">C/C++的开发工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#C语言相关"><span class="toc-number">3.</span> <span class="toc-text">C语言相关</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体的概念"><span class="toc-number">3.1.</span> <span class="toc-text">结构体的概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体的其它定义形式"><span class="toc-number">3.2.</span> <span class="toc-text">结构体的其它定义形式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体的嵌套"><span class="toc-number">3.3.</span> <span class="toc-text">结构体的嵌套</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体数组"><span class="toc-number">3.4.</span> <span class="toc-text">结构体数组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#动态内存分配"><span class="toc-number">3.5.</span> <span class="toc-text">动态内存分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体动态内存分配"><span class="toc-number">3.6.</span> <span class="toc-text">结构体动态内存分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#结构体与函数指针"><span class="toc-number">3.7.</span> <span class="toc-text">结构体与函数指针</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#放在后边"><span class="toc-number">4.</span> <span class="toc-text">放在后边</span></a></li></ol></div></div><div class="post-content"><h3 id="放在前边"><a href="#放在前边" class="headerlink" title="放在前边"></a>放在前边</h3><blockquote>
<p>注：本篇是C语言的基础知识补习的第二篇，共三篇，需要读者有一定的编程经验。</p>
</blockquote>
<p><a href="https://github.com/drawf/demo.c" target="_blank" rel="external">demo.c传送门</a></p>
<h3 id="C-C-的开发工具"><a href="#C-C-的开发工具" class="headerlink" title="C/C++的开发工具"></a>C/C++的开发工具</h3><p>链接: <a href="https://pan.baidu.com/s/1eSh1Uuu" target="_blank" rel="external">https://pan.baidu.com/s/1eSh1Uuu</a> 密码: sp3t</p>
<p>CLion for Mac 2016.3 版本，CMake workflow、Modern C and C++、Semantic highlighting等新特性，<br>CLion 是一款由JetBrains出品的强大的C/C++开发工具，支持Windows、Mac、Linux平台，是现代的智能集成开发工具，支持各种功能，如代码自动完成、提醒、版本控制工具等，支持C、C++、 C++11 等标准，非常的不错！</p>
<h3 id="C语言相关"><a href="#C语言相关" class="headerlink" title="C语言相关"></a>C语言相关</h3><h4 id="结构体的概念"><a href="#结构体的概念" class="headerlink" title="结构体的概念"></a>结构体的概念</h4><p>如同class（类）是Java中的结构化数据核心一样，struct（结构体）就是C语言中的结构化数据核心。</p>
<p>结构体中只有声明，函数不能实现，属性也不能初始化，需要在外部赋值，一般定义在头文件中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*定义一个Person结构体，关键字为struct*/</span></div><div class="line">struct Person &#123;</div><div class="line">    <span class="keyword">char</span> *name;</div><div class="line">    <span class="keyword">int</span> age;</div><div class="line">&#125;;</div><div class="line"></div><div class="line">struct News &#123;</div><div class="line">    <span class="keyword">char</span> title[<span class="number">123</span>];</div><div class="line">    <span class="keyword">char</span> *content;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">/*简单使用*/</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSimpleStruct</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    struct Person person = &#123;<span class="string">"张三"</span>, <span class="number">25</span>&#125;;</div><div class="line">    printf(<span class="string">"name:%s ==&gt; age:%d\n"</span>, person.name, person.age);</div><div class="line">    <span class="comment">//name:张三 ==&gt; age:25</span></div><div class="line"></div><div class="line">    person.name = <span class="string">"Bob"</span>;</div><div class="line">    person.age = <span class="number">23</span>;</div><div class="line">    printf(<span class="string">"name:%s ==&gt; age:%d\n"</span>, person.name, person.age);</div><div class="line">    <span class="comment">//name:Bob ==&gt; age:23</span></div><div class="line"></div><div class="line">    struct News news;</div><div class="line">    <span class="comment">//news.title = "我是新闻标题"; 这是错误的赋值方法！报错为：array is not assignable</span></div><div class="line">    <span class="comment">//因为 news.title 是数组类型，"我是新闻标题"是 char * 类型</span></div><div class="line">    strcpy(news.title, <span class="string">"我是新闻标题"</span>);<span class="comment">//正确的赋值方法</span></div><div class="line">    news.content = <span class="string">"我是内容"</span>;</div><div class="line">    printf(<span class="string">"title:%s ==&gt; content:%s\n"</span>, news.title, news.content);</div><div class="line">    <span class="comment">//title:我是新闻标题 ==&gt; content:我是内容</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="结构体的其它定义形式"><a href="#结构体的其它定义形式" class="headerlink" title="结构体的其它定义形式"></a>结构体的其它定义形式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*定义结构体时，同时定义一个或多个它的变量或指针。按照属性不能初始化原则，变量或指针都是没有值的*/</span></div><div class="line">struct Product &#123;</div><div class="line">    <span class="keyword">char</span> *name;</div><div class="line">    <span class="keyword">char</span> *desc;</div><div class="line">&#125; product, *pProduct, product1;</div><div class="line"></div><div class="line"><span class="comment">/*匿名结构体，可以做单例使用*/</span></div><div class="line">struct &#123;</div><div class="line">    <span class="keyword">char</span> *name;</div><div class="line">    <span class="keyword">int</span> age;</div><div class="line">&#125; *pStudent, student;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSimpleStruct2</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    product.name = <span class="string">"苹果手机"</span>;</div><div class="line">    product.desc = <span class="string">"就是贵"</span>;</div><div class="line">    printf(<span class="string">"name:%s ==&gt; desc:%s\n"</span>, product.name, product.desc);</div><div class="line">    <span class="comment">//name:苹果手机 ==&gt; desc:就是贵</span></div><div class="line"></div><div class="line">    product1.name = <span class="string">"小米手机"</span>;</div><div class="line">    product1.desc = <span class="string">"广告就是多"</span>;</div><div class="line">    pProduct = &amp;product1;</div><div class="line">    <span class="comment">/*通过指针操作属性，结构体指针使用 p-&gt;xx 操作符，相当于 (*p).xx 的简写*/</span></div><div class="line">    printf(<span class="string">"name:%s ==&gt; desc:%s\n"</span>, (*pProduct).name, pProduct-&gt;desc);</div><div class="line">    <span class="comment">//name:小米手机 ==&gt; desc:广告就是多</span></div><div class="line"></div><div class="line">    pStudent = &amp;student;</div><div class="line">    (*pStudent).name = <span class="string">"张三"</span>;</div><div class="line">    pStudent-&gt;age = <span class="number">23</span>;</div><div class="line">    printf(<span class="string">"name:%s ==&gt; age:%d\n"</span>, student.name, student.age);</div><div class="line">    <span class="comment">//name:张三 ==&gt; age:23</span></div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="结构体的嵌套"><a href="#结构体的嵌套" class="headerlink" title="结构体的嵌套"></a>结构体的嵌套</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">struct ProductBean &#123;</div><div class="line">    <span class="keyword">int</span> total;</div><div class="line">    <span class="keyword">int</span> state;</div><div class="line"></div><div class="line">    <span class="comment">/*嵌套已定义好的结构体*/</span></div><div class="line">    struct Product product;</div><div class="line"></div><div class="line">    <span class="comment">/*嵌套新声明的结构体*/</span></div><div class="line">    struct Readme &#123;</div><div class="line">        <span class="keyword">char</span> *content;</div><div class="line">    &#125; readme;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testSimpleStruct3</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    ProductBean pb = &#123;<span class="number">10</span>, <span class="number">1</span>, &#123;<span class="string">"苹果手机"</span>, <span class="string">"就是贵"</span>&#125;, <span class="string">"售出不退"</span>&#125;;</div><div class="line">    printf(<span class="string">"total:%d ==&gt; state:%d ==&gt; name:%s ==&gt; desc:%s ==&gt; content:%s\n"</span>,</div><div class="line">           pb.total, pb.state, pb.product.name, pb.product.desc, pb.readme.content);</div><div class="line">    <span class="comment">//total:10 ==&gt; state:1 ==&gt; name:苹果手机 ==&gt; desc:就是贵 ==&gt; content:售出不退</span></div><div class="line"></div><div class="line">    ProductBean pb1;</div><div class="line">    ProductBean *p = &amp;pb1;</div><div class="line">    p-&gt;total = <span class="number">2</span>;</div><div class="line">    p-&gt;state = <span class="number">1</span>;</div><div class="line">    p-&gt;product.name = <span class="string">"小米手机"</span>;</div><div class="line">    p-&gt;product.desc = <span class="string">"就是便宜"</span>;</div><div class="line">    p-&gt;readme.content = <span class="string">"开机不会爆炸"</span>;</div><div class="line">    printf(<span class="string">"total:%d ==&gt; state:%d ==&gt; name:%s ==&gt; desc:%s ==&gt; content:%s\n"</span>,</div><div class="line">           p-&gt;total, p-&gt;state, p-&gt;product.name, p-&gt;product.desc, p-&gt;readme.content);</div><div class="line">    <span class="comment">//total:2 ==&gt; state:1 ==&gt; name:小米手机 ==&gt; desc:就是便宜 ==&gt; content:开机不会爆炸</span></div><div class="line"></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<h4 id="结构体数组"><a href="#结构体数组" class="headerlink" title="结构体数组"></a>结构体数组</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testStructArray</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    Person person1 = &#123;<span class="string">"张三"</span>, <span class="number">21</span>&#125;;</div><div class="line">    Person person2 = &#123;<span class="string">"李四"</span>, <span class="number">33</span>&#125;;</div><div class="line"></div><div class="line">    Person persons[] = &#123;person1, person2, &#123;<span class="string">"赵六"</span>, <span class="number">55</span>&#125;&#125;;</div><div class="line"></div><div class="line">    <span class="comment">//计算数组长度</span></div><div class="line">    <span class="keyword">int</span> len = sizeof(persons) / sizeof(Person);</div><div class="line">    printf(<span class="string">"数组长度：%d\n"</span>, len);</div><div class="line">    <span class="comment">//数组长度：3</span></div><div class="line"></div><div class="line">    <span class="comment">//通过指针遍历数组</span></div><div class="line">    <span class="keyword">for</span> (Person *pPerson = persons; pPerson &lt; persons + len; pPerson++) &#123;</div><div class="line">        printf(<span class="string">"name:%s ==&gt; age:%d\n"</span>, pPerson-&gt;name, pPerson-&gt;age);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//name:张三 ==&gt; age:21</span></div><div class="line">    <span class="comment">//name:李四 ==&gt; age:33</span></div><div class="line">    <span class="comment">//name:赵六 ==&gt; age:55</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="动态内存分配"><a href="#动态内存分配" class="headerlink" title="动态内存分配"></a>动态内存分配</h4><p><em>动态内存分配</em>：在程序运行过程中，动态指定需要使用的内存大小，并手动释放，释放之后这些内存还可以被重新使用<br><em>静态内存分配</em>：分配的内存大小是固定的，存在问题：1.很容易超出栈内存的最大值 2.为了防止内存不够用会开辟更多的内存，容易浪费内存</p>
<p>C/C++编译的程序占用的内存分配表</p>
<table>
<thead>
<tr>
<th style="text-align:center">内存</th>
<th style="text-align:center">描述</th>
<th style="text-align:center">特性</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">栈区（stack）</td>
<td style="text-align:center">windows下，栈内存分配2M（确定的常数），超出了限制，提示stack overflow错误</td>
<td style="text-align:center">编译器自动分配释放，主要存放函数的参数值，局部变量值等</td>
</tr>
<tr>
<td style="text-align:center">堆区（heap）</td>
<td style="text-align:center">用于动态内存分配</td>
<td style="text-align:center">程序员手动分配释放，可占操作系统80%内存</td>
</tr>
<tr>
<td style="text-align:center">全局区或静态区</td>
<td style="text-align:center">存放全局变量和静态变量；程序结束时由系统释放，分为全局初始化区和全局未初始化区</td>
<td style="text-align:center">只初始化一次</td>
</tr>
<tr>
<td style="text-align:center">字符常量区</td>
<td style="text-align:center">常量字符串放于此</td>
<td style="text-align:center">程序结束时由系统释放</td>
</tr>
<tr>
<td style="text-align:center">程序代码区</td>
<td style="text-align:center">存放函数体的二进制代码</td>
<td style="text-align:center">该区指令中包括操作码和要操作的对象（或对象地址引用）</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> a=<span class="number">0</span>;<span class="comment">//全局初始化区</span></div><div class="line"><span class="keyword">char</span> *p;<span class="comment">//全局未初始化区</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</div><div class="line"></div><div class="line">   <span class="keyword">int</span> b;          <span class="comment">//栈</span></div><div class="line">   <span class="keyword">char</span> c[]=<span class="string">"bb"</span>;  <span class="comment">//栈</span></div><div class="line">   <span class="keyword">char</span> *p1;       <span class="comment">//栈</span></div><div class="line">   <span class="keyword">char</span> *p2=<span class="string">"123"</span>; <span class="comment">//其中，"123"在常量区，p3在栈区</span></div><div class="line">   <span class="keyword">static</span> <span class="keyword">int</span> c=<span class="number">0</span>; <span class="comment">//全局区</span></div><div class="line"></div><div class="line">   p1=(<span class="keyword">char</span>*)malloc(<span class="number">10</span>);   <span class="comment">//10个字节区域在堆区</span></div><div class="line">   strcpy(p1,<span class="string">"123"</span>);    <span class="comment">//"123"在常量区，编译器可能会优化为和p2的指向同一块区域</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>malloc()</code>函数用来动态地申请连续的内存空间，<code>realloc()</code>函数用来重新分配内存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testMalloc</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">//静态内存分配创建数组，数组大小是固定的</span></div><div class="line">    <span class="comment">//int i = 10;</span></div><div class="line">    <span class="comment">//int a[i];</span></div><div class="line"></div><div class="line">    <span class="keyword">int</span> len = <span class="number">5</span>;</div><div class="line">    printf(<span class="string">"数组的长度：%d\n"</span>, len);</div><div class="line">    <span class="comment">//数组的长度：5</span></div><div class="line"></div><div class="line">    <span class="comment">//开辟内存，大小为len*4字节，p是数组的首地址，p就是数组的名称</span></div><div class="line">    <span class="keyword">int</span> *p = (<span class="keyword">int</span> *) malloc(len * sizeof(<span class="keyword">int</span>));</div><div class="line"></div><div class="line">    <span class="comment">//给数组元素赋值（使用这一块刚刚开辟出来的连续的内存空间）</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">        p[i] = rand() % <span class="number">100</span>;</div><div class="line">        printf(<span class="string">"数组元素值为：%d ==&gt; 地址为：%#x\n"</span>, p[i], &amp;p[i]);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//数组元素值为：7 ==&gt; 地址为：0x8ec02850</span></div><div class="line">    <span class="comment">//数组元素值为：49 ==&gt; 地址为：0x8ec02854</span></div><div class="line">    <span class="comment">//数组元素值为：73 ==&gt; 地址为：0x8ec02858</span></div><div class="line">    <span class="comment">//数组元素值为：58 ==&gt; 地址为：0x8ec0285c</span></div><div class="line">    <span class="comment">//数组元素值为：30 ==&gt; 地址为：0x8ec02860</span></div><div class="line"></div><div class="line">    <span class="keyword">int</span> addLen = <span class="number">5</span>;</div><div class="line">    printf(<span class="string">"数组增加的长度：%d\n"</span>, addLen);</div><div class="line">    <span class="comment">//数组的长度：5</span></div><div class="line"></div><div class="line">    <span class="comment">//新内存大小为(len+addLen)*4字节</span></div><div class="line">    <span class="keyword">int</span> *p1 = (<span class="keyword">int</span> *) realloc(p, (len + addLen) * sizeof(<span class="keyword">int</span>));</div><div class="line">    <span class="keyword">if</span> (p1 == NULL) &#123;</div><div class="line">        printf(<span class="string">"内存重新分配失败"</span>);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len + addLen; i++) &#123;</div><div class="line">            p1[i] = rand() % <span class="number">100</span>;</div><div class="line">            printf(<span class="string">"数组元素值为：%d ==&gt; 地址为：%#x\n"</span>, p1[i], &amp;p1[i]);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//数组元素值为：72 ==&gt; 地址为：0x8ec02850</span></div><div class="line">    <span class="comment">//数组元素值为：44 ==&gt; 地址为：0x8ec02854</span></div><div class="line">    <span class="comment">//数组元素值为：78 ==&gt; 地址为：0x8ec02858</span></div><div class="line">    <span class="comment">//数组元素值为：23 ==&gt; 地址为：0x8ec0285c</span></div><div class="line">    <span class="comment">//数组元素值为：9 ==&gt; 地址为：0x8ec02860</span></div><div class="line">    <span class="comment">//数组元素值为：40 ==&gt; 地址为：0x8ec02864</span></div><div class="line">    <span class="comment">//数组元素值为：65 ==&gt; 地址为：0x8ec02868</span></div><div class="line">    <span class="comment">//数组元素值为：92 ==&gt; 地址为：0x8ec0286c</span></div><div class="line">    <span class="comment">//数组元素值为：42 ==&gt; 地址为：0x8ec02870</span></div><div class="line">    <span class="comment">//数组元素值为：87 ==&gt; 地址为：0x8ec02874</span></div><div class="line"></div><div class="line">    <span class="comment">//手动释放内存，free()释放动态分配的内存空间</span></div><div class="line">    <span class="keyword">if</span> (p != NULL) &#123;</div><div class="line">        free(p);</div><div class="line">        p = NULL;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (p1 != NULL) &#123;</div><div class="line">        free(p1);</div><div class="line">        p1 = NULL;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>realloc()</code>重新分配内存的特点：</p>
<ol>
<li>如果是缩小内存，缩小的那部分数据会丢失，扩大时内存依旧是连续的</li>
<li>如果当前内存段后的内存空间够用，会直接扩展这段内存空间，返回原指针</li>
<li>如果当前内存段后的空闲内存不够用，就会使用堆中的第一个能够满足这一要求的内存块，将目前的数据复制到新的位置，并将原来的数据释放掉，返回新的内存地址</li>
<li>如果申请失败，返回NULL，原来的指针仍然有效</li>
</ol>
<p>内存分配需要注意的几点：</p>
<ol>
<li>不能多次释放</li>
<li>释放完之后（指针仍然有值），给指针置NULL，标志释放完成</li>
<li>内存泄露（p需要在赋值之前释放前一个内存空间）</li>
</ol>
<h4 id="结构体动态内存分配"><a href="#结构体动态内存分配" class="headerlink" title="结构体动态内存分配"></a>结构体动态内存分配</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testStructMalloc</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    Person *person = (Person *) malloc(sizeof(Person) * <span class="number">5</span>);</div><div class="line">    Person *p = person;</div><div class="line">    p-&gt;name = <span class="string">"小明"</span>;</div><div class="line">    p-&gt;age = <span class="number">17</span>;</div><div class="line">    p++;</div><div class="line">    p-&gt;name = <span class="string">"小李"</span>;</div><div class="line">    p-&gt;age = <span class="number">22</span>;</div><div class="line">    p++;</div><div class="line">    p-&gt;name = <span class="string">"小王吧"</span>;</div><div class="line">    p-&gt;age = <span class="number">13</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (Person *i = person; i &lt; person + <span class="number">3</span>; i++) &#123;</div><div class="line">        printf(<span class="string">"name:%s ==&gt; age:%d\n"</span>, i-&gt;name, i-&gt;age);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//name:小明 ==&gt; age:17</span></div><div class="line">    <span class="comment">//name:小李 ==&gt; age:22</span></div><div class="line">    <span class="comment">//name:小王吧 ==&gt; age:13</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="结构体与函数指针"><a href="#结构体与函数指针" class="headerlink" title="结构体与函数指针"></a>结构体与函数指针</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">struct Dog &#123;</div><div class="line">    <span class="keyword">char</span> *name;</div><div class="line">    <span class="keyword">int</span> age;</div><div class="line"></div><div class="line">    <span class="comment">//结构体中不能有函数实体</span></div><div class="line">    <span class="keyword">void</span> (*wow)(<span class="keyword">char</span> *);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">dogWow</span><span class="params">(<span class="keyword">char</span> *msg)</span> </span>&#123;</div><div class="line">    printf(<span class="string">"dog 说:%s\n"</span>, msg);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">testDogWow</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    Dog dog = &#123;<span class="string">"吉娃娃"</span>, <span class="number">2</span>, dogWow&#125;;<span class="comment">//将函数名称赋值给函数指针</span></div><div class="line">    dog.wow(<span class="string">"汪汪！"</span>);</div><div class="line">    printf(<span class="string">"函数的地址：%#x\n"</span>, dogWow);</div><div class="line">    <span class="comment">//dog 说:汪汪！</span></div><div class="line">    <span class="comment">//函数的地址：0xcf56d20</span></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="放在后边"><a href="#放在后边" class="headerlink" title="放在后边"></a>放在后边</h3><p>如有疑问和建议欢迎留言。</p>
</div><div class="tags"><a href="/tags/C语言/">C语言</a></div><div class="post-nav"><a href="/2017/02/27/c-basics-record-3/" class="pre">C语言基础知识补习③</a><a href="/2017/02/18/c-basics-record-1/" class="next">C语言基础知识补习①</a></div><div data-thread-key="2017/02/22/c-basics-record-2/" data-title="C语言基础知识补习②" data-url="http://51erwa.com/2017/02/22/c-basics-record-2/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2017/02/22/c-basics-record-2/" data-title="C语言基础知识补习②" data-url="http://51erwa.com/2017/02/22/c-basics-record-2/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="站内搜索" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">tech</a><span class="category-list-count">6</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/C语言/" style="font-size: 15px;">C语言</a> <a href="/tags/Retrofit2-0/" style="font-size: 15px;">Retrofit2.0</a> <a href="/tags/OkHttp/" style="font-size: 15px;">OkHttp</a> <a href="/tags/RxJava/" style="font-size: 15px;">RxJava</a> <a href="/tags/RESTful/" style="font-size: 15px;">RESTful</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/02/27/c-basics-record-3/">C语言基础知识补习③</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/22/c-basics-record-2/">C语言基础知识补习②</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/18/c-basics-record-1/">C语言基础知识补习①</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/08/okhttp+rxjava-experience/">结合Retrofit2.0体验OkHttp+RxJava</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/01/11/retrofit2-experience/">全面体验Retrofit2.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/11/30/what-is-RESTful/">彻底理解什么是REST</a></li></ul></div><div class="widget"><div class="comments-title"><i class="fa fa-comment-o"> 最近评论</i></div><div data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-admin="1" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://wanzi.tv/" title="丸子影视" target="_blank">丸子影视</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">erwa'blog.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> Deployed in<a rel="nofollow" target="_blank" href="https://github.com/drawf"> GitHub.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var duoshuoQuery = {short_name:'erwa'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>